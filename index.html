<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="A mathematical path puzzle game">
        <title>PATH PUZZLE</title>
        
        <!-- Favicon -->
        <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ§®</text></svg>">
        
        <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom": "https://esm.sh/react-dom@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client"
  }
}
</script>
<script type="module">
  import React from 'react';
  import * as ReactDOM from 'react-dom';
  
  // Add compatibility for older code expecting ReactDOM.createRoot
  if (!ReactDOM.createRoot && ReactDOM.default && ReactDOM.default.createRoot) {
    ReactDOM.createRoot = ReactDOM.default.createRoot;
  } else if (!ReactDOM.createRoot) {
    // Fallback for older React versions
    ReactDOM.createRoot = (container) => ({
      render: (element) => ReactDOM.render(element, container)
    });
  }
  
  window.React = React;
  window.ReactDOM = ReactDOM;
  
  console.log('React initialized:', {
    reactVersion: React.version,
    hasCreateRoot: typeof ReactDOM.createRoot === 'function'
  });
</script>
        <script src="https://cdn.tailwindcss.com"></script>
        <script>
          tailwind.config = {
            content: [
              "./index.html",
              "./js/*.js"
            ]
          }
        </script>
            
        <!-- Preload critical resources -->
        <link rel="preload" href="styles/main.css" as="style">
        
        <!-- Stylesheets -->
        <link rel="stylesheet" href="styles/main.css">
        
        <!-- Module Preloading -->
        <link rel="modulepreload" href="js/GameController.js">
        <link rel="modulepreload" href="js/GameState.js">
        <link rel="modulepreload" href="js/GridEventHandler.js">
        <link rel="modulepreload" href="js/pathGenerator.js">
        <link rel="modulepreload" href="js/sequenceGenerator.js">
        <link rel="modulepreload" href="js/gridRenderer.js">
        <link rel="modulepreload" href="js/scoreBox.js">
        <link rel="modulepreload" href="js/scoreManager.js">
        <link rel="modulepreload" href="js/pathValidator.js">
        <link rel="modulepreload" href="js/puzzleSymbols.js">
        <link rel="modulepreload" href="js/rules.js">
            
    </head>
    <body>
        <noscript>You need to enable JavaScript to run this game.</noscript>

        <!-- React Rules Component Container -->
        <div id="rules-container"></div>

        <div class="game-container">
            <!-- Header Section -->
            <header class="game-header">
                <h1>PATH PUZZLE</h1>
                
                <!-- Score Display -->
                <div class="score-display">
                    <div id="score-component"></div>
                    <span id="score" style="display: none;">0</span>
                </div>
            </header>

            <section class="level-selector" style="position: relative; z-index: 1000;">
                <div class="level-buttons">
                    <button 
                        type="button" 
                        class="level-btn rounded text-white font-bold" 
                        data-level="1">
                        Level 1
                    </button>
                    <button 
                        type="button" 
                        class="level-btn rounded text-white font-bold" 
                        data-level="2">
                        Level 2
                    </button>
                    <button 
                        type="button" 
                        class="level-btn rounded text-white font-bold" 
                        data-level="3">
                        Level 3
                    </button>
                    <button 
                        type="button" 
                        class="level-btn rounded text-white font-bold" 
                        data-level="4">
                        Level 4
                    </button>
                    <button 
                        type="button" 
                        class="level-btn rounded text-white font-bold" 
                        data-level="5">
                        Level 5
                    </button>
                </div>
            </section>
            
            <!-- Main Game Area -->
            <main class="game-board">
                <!-- Grid Container -->
                <div id="grid-container"></div>
                
                <!-- Sequence Container -->
                <div class="sequence-container" style="display: none;">
                    <div id="sequence-sums" class="sequence-list"></div>
                </div>
                
                <!-- Game Controls -->
                <div class="game-controls">
                    <button id="check-solution" disabled>
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M20 6 9 17l-5-5"/>
                        </svg>
                        Check Solution
                    </button>
                    
                    <button id="remove-spare" disabled>
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                        Remove Spare Cells
                    </button>
                </div>

                <!-- Game Messages -->
                <div id="game-messages" class="message-box"></div>
            </main>
        </div>
        
        <!-- Game Modules -->
        <script type="module" src="js/GameController.js"></script>
        <script type="module" src="js/GameState.js"></script>
        <script type="module" src="js/GridEventHandler.js"></script>
        <script type="module" src="js/pathGenerator.js"></script>
        <script type="module" src="js/sequenceGenerator.js"></script>
        <script type="module" src="js/gridRenderer.js"></script>
        <script type="module" src="js/scoreBox.js"></script>
        <script type="module" src="js/scoreManager.js"></script>
        <script type="module" src="js/pathValidator.js"></script>
        <script type="module" src="js/rules.js"></script>
        <script type="module" src="js/puzzleSymbols.js"></script>
    
        <!-- React Component Mounting -->
        <script type="module">
    import GameController from './js/GameController.js';
    import Rules from './js/rules.js';
    
    console.error('DEBUG: Starting initialization');
    console.error('DEBUG: GameController imported:', typeof GameController);
    console.error('DEBUG: Rules imported:', typeof Rules);

    // Ensure components are mounted after DOM is fully loaded
    document.addEventListener('DOMContentLoaded', () => {
        try {
            console.error('DOM Loaded - Starting GameController initialization');
            
            // Create game controller
            const controller = new GameController();
            console.error('GameController instance created:', controller);
            
            // Store in window for debugging
            window._gameController = controller;
            console.error('GameController stored in window:', window._gameController);
            
            // Mount React components - with fallback options
            const rulesContainer = document.getElementById('rules-container');
            
            if (rulesContainer) {
                if (typeof window.ReactDOM.createRoot === 'function') {
                    // React 18 method
                    const root = window.ReactDOM.createRoot(rulesContainer);
                    root.render(window.React.createElement(Rules));
                    console.error('Mounted Rules using createRoot (React 18+)');
                } else if (typeof window.ReactDOM.render === 'function') {
                    // React 17 and earlier fallback
                    window.ReactDOM.render(window.React.createElement(Rules), rulesContainer);
                    console.error('Mounted Rules using render (React 17-)');
                } else {
                    console.error('ERROR: No ReactDOM rendering method available');
                }
            } else {
                console.error('ERROR: Rules container not found');
            }
            
            // Dispatch game start event
            window.dispatchEvent(new CustomEvent('gameStart'));
            
            console.error('Initialization complete');
        } catch (error) {
            console.error('CRITICAL ERROR during initialization:', error);
            console.error('Error stack:', error.stack);
        }
    });

    // Add backup initialization check
    setTimeout(() => {
        console.error('Delayed initialization check:', {
            hasController: !!window._gameController,
            controllerType: typeof window._gameController,
            reactDOM: !!window.ReactDOM,
            hasCreateRoot: typeof window.ReactDOM?.createRoot === 'function',
            hasRender: typeof window.ReactDOM?.render === 'function'
        });
        
        // If controller not initialized properly, try again
        if (!window._gameController) {
            console.error('Controller not initialized properly, attempting recovery...');
            const controller = new GameController();
            window._gameController = controller;
            window.dispatchEvent(new CustomEvent('gameStart'));
        }
    }, 2000);
</script>
    </body>
</html>
